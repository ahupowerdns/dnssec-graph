<html>                                                                  
 <head>                                                                  
<style type="text/css">
body {
	font-family: Verdana,Arial,Helvetica,sans-serif;
	font-size: 14px;
	margin: 1.2em;
}
</style>

<!--[if lt IE 9]><script language="javascript" type="text/javascript"
src="jqplot/excanvas.js"></script><![endif]-->

 <script type="text/javascript" src="jquery-1.7.2.min.js"></script>          

 <script language="javascript" type="text/javascript" src="jqplot/jquery.jqplot.min.js"></script>

 <link rel="stylesheet" type="text/css" href="jqplot/jquery.jqplot.css"/>
 <script type="text/javascript" language="javascript" src="jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
 <script type="text/javascript" language="javascript" src="jqplot/plugins/jqplot.barRenderer.min.js"></script>
 <script type="text/javascript" src="jqplot/plugins/jqplot.highlighter.min.js"></script>
 <script type="text/javascript" src="jqplot/plugins/jqplot.cursor.min.js"></script> 
 <script type="text/javascript" src="moment.min.js"></script>
 <script type="text/javascript">                                         

var themaxTime; // latest update

// this function gets passed a string containing "time_t value" lines, and
// plots it to <div id="graph"/>
function plotData(data, textStatus)
{
	var lines = data.split("\n");					  	
	var points=[];
	
	var themaxVal=0;
	themaxTime=0;
	for(i = 0; i < lines.length; ++i) {				  	
		var items = lines[i].split(" ");			  	
		if(items.length != 2)					  	
			break;						  	
		points.push([items[0]*1000, items[1]]);			  	
		themaxTime = Math.max(themaxVal, items[0]);
		themaxVal = Math.max(themaxVal, items[1]);
	}			
	
	$("#graph").html(""); // clear previous graph
	$.jqplot("graph", [points],					  	
	{								  	
		title: 'Number of DNSSEC domains in the .NL zone: '+themaxVal,	  	
		axes: {							  	
			xaxis: {					  	
				renderer: $.jqplot.DateAxisRenderer
			},						  	
			yaxis:						  	
			{						  	
				min: 0,
				max: 1.3* themaxVal
			},
		},
		highlighter: {
		        show: true,
		        sizeAdjust: 7.5
		},
		cursor: {
			show: true,
			zoom: true,
			constrainZoomTo: 'x',
			showCursorLegend: false
		}
	});
	updateAge();								  		
}

function updateAge()
{
	$("#last-data-point").html(moment(themaxTime*1000).fromNow());
}

function updateGraph()
{
	$.get("sidn-dnssec-plot", "", plotData);	
}

$(document).ready(function() {
	updateGraph();
	refreshId = setInterval(updateGraph, 300000);
	refreshId2 = setInterval(updateAge, 10000);
	moment.lang('en');
	$.ajaxSetup({cache: false} );
});
 </script>                                                               
 </head>                                                                 
 <body>
 <table width="100%"><tr><td align="right">
 
 </td></td></table>
 <p>
   <center>
   	<img src="Logo.gif">
   	<p/>
   <div id="graph" align="center" style="height:400px;width:90%;"></div>
   Data last updated <span id="last-data-point"/>
   </center>
   <p>
   New <a href="sidn-dnssec-plot">numbers</a> are polled from <a
   href="http://www.sidn.nl">SIDN</a> every 5 minutes. The graph will
   autorefresh. Time is your local time.
   These numbers are not official; this graph is not generated by SIDN; not
   all domains are in fact served from PowerDNS.
   <p>
   The graph can be zoomed by dragging a box around the time range you want to see; double click to unzoom.
   <p>
   If you have historical data, please contact bert.hubert@netherlabs.nl so
   we can make this graph complete!
 </body>                                                                 
 </html>
